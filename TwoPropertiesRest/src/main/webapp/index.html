<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <title>Group 16</title>
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
  <script>
  var lego=new Object();
  lego.id=1;
  lego.run=1;
  lego.speed=0;
  lego.turn=0;
  function sendData(form){
		//lego.speed=form.speed.value;
		var json=JSON.stringify(lego);
		var xhttp = new XMLHttpRequest();
		
		xhttp.onreadystatechange = function() {
		  if (this.readyState == 4 && this.status == 200) {
		   var settings=JSON.parse(this.responseText);
		   document.getElementById("settings").innerHTML="ID="+settings.id+" Run="+settings.run+" Speed="+settings.speed+" Turn="+settings.turn;
		  }
		};
		
		xhttp.open("POST","/rest/lego/setvalues",true);
		xhttp.setRequestHeader("Content-type","application/json");
		xhttp.send(json);
		getHistory();
	}
  function getHistory() {
	    var xhttp = new XMLHttpRequest();

	    xhttp.onreadystatechange = function() {
	        if (this.readyState == 4 && this.status == 200) {
	            let history = JSON.parse(this.responseText);
	            let historyHTML = "<ul>";
	            history.forEach(function(item) {
	                historyHTML += "<li>ID: " + item.id + ", Run: " + item.run + ", Speed: " + item.speed + ", Turn: " + item.turn + "</li>";
	            });
	            historyHTML += "</ul>";
	            document.getElementById("history").innerHTML = historyHTML;
	        }
	    };
	    xhttp.open("GET", "/rest/lego/gethistory", true);
	    xhttp.send();
	}

  function moveForward(form) {
	    lego.speed = Math.abs(lego.speed); // Ensure speed is positive
	    sendData(form);
	}

	function moveBackward(form) {
	    lego.speed = -Math.abs(lego.speed); // Ensure speed is negative
	    sendData(form);
	}

  function turnLeft(form){
	  lego.turn=lego.turn-10;
	  sendData(form);
  }
  function turnRight(form){
	  lego.turn=lego.turn+10;
	  sendData(form);
  }
  function stoplego(form){
	  lego.run=0;
	  sendData(form);
  }
  function speeddown(form){
	  lego.speed=lego.speed-10;
	  sendData(form);
  }  
  function speedup(form){
	  lego.speed=lego.speed+10;
	  sendData(form);
  }
  </script>
    <h1>Lego Settings!</h1>
	<h3>Lego</h3>
	<p id='lego'>
	</p>
	<h3>New values</h3>
    <form id='legoform'>
    <!-- Speed: <input type='text' name='speed' value=''><br> -->
    <div class="button-group">
      <input type='button' name='forward' value='Forward' onclick='moveForward(this.form);'>
      <input type='button' name='backward' value='Backward' onclick='moveBackward(this.form);'>
      <input type='button' name='left' value='Left' onclick='turnLeft(this.form);'>
      <input type='button' name='right' value='Right' onclick='turnRight(this.form);'>
      <input type='button' name='speedDown' value='Speed up' onclick='speedup(this.form);'>
      <input type='button' name='speedUp' value='Speed down' onclick='speeddown(this.form);'>
    </div>
    <div class="button-group">
      <input type='button' name='stop' value='STOP' onclick='stoplego(this.form);'>
      <input type='button' name='ok' value='OK' onclick='sendData(this.form);'>
    </div>
    </form>
	<p id='settings'>
	</p>
	<h3>Settings History</h3>
	<p id="history">
	    </p>
  </body>
</html>